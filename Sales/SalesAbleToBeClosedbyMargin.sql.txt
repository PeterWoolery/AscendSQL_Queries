Select Locations.Name, SUM((SalesItems.Price-SalesItems.COGS)*SalesItems.Quantity) AS [Gross Margin Closeable] FROM Locations, Sales, SalesItems WHERE SalesItems.SalesID = Sales.ID AND Sales.FinishDate IS NULL AND Sales. QUOTE <> 1 AND Sales.Hide <> 1 AND Sales.Payments = Sales.Total AND SalesItems.Hide <> 1 AND Locations.ActiveStore = 1 AND Sales.ID NOT IN (SELECT Sales.ID FROM Sales, SalesItems, OrderItems WHERE Sales.ID = SalesItems.SalesID AND SalesItems.Backorder = 1 and Sales.Hide <> 1 AND Sales.Quote <> 1 AND SalesItems.Hide <> 1 AND OrderItems.ID = SalesItems.OrderItemID AND OrderItems.DateReceived IS NULL) GROUP BY Locations.Name
